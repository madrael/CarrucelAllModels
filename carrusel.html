<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title id="pageTitle">Galería – Modelos</title>
<style>
  :root{ --radius:14px; --shadow:0 8px 24px rgba(0,0,0,.08);
    --ink:#111; --muted:#4b5563; --line:#1f2937; --card:#fff; }
  *{box-sizing:border-box}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;padding:28px 20px 48px;color:var(--ink);background:#fff}
  h1{font-size:clamp(26px,3vw,44px);margin:0 0 22px;font-weight:650}
  .wrap{max-width:1180px;margin:0 auto}
  .grid{display:grid;grid-template-columns:1.4fr 1fr;gap:28px;align-items:stretch}
  @media (max-width:900px){.grid{grid-template-columns:1fr}}
  .figure{background:#f5f5f7;border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow);display:flex;align-items:center;justify-content:center;min-height:360px}
  .figure img{width:100%;height:100%;object-fit:cover;display:block}
  .fade{animation:fade .35s ease-out}
  @keyframes fade{from{opacity:.2} to{opacity:1}}
  .textCol{border-radius:12px}
  .features{display:flex;flex-direction:column;gap:14px}
  .feat{background:var(--card);border:1px solid #e5e7eb;border-radius:12px;padding:14px 16px;box-shadow:0 1px 2px rgba(0,0,0,.03);position:relative;cursor:pointer}
  .feat-title{margin:0;font-size:18px;font-weight:650;line-height:1.35}
  .feat-desc{margin:10px 2px 2px;color:var(--muted);line-height:1.55;font-size:15px;display:none}
  .feat.active{border-color:#d1d5db}
  .feat.active::before{content:"";position:absolute;left:-1px;top:-1px;bottom:-1px;width:4px;border-radius:12px 0 0 12px;background:var(--line)}
  .feat.active .feat-desc{display:block}
  .controls-global{display:flex;justify-content:center;align-items:center;gap:18px;margin-top:18px}
  .btn{width:42px;height:42px;border-radius:50%;border:1px solid #d1d5db;background:#fff;display:grid;place-items:center;cursor:pointer;box-shadow:var(--shadow);transition:transform .08s}
  .btn:active{transform:scale(.96)}
  .btn svg{width:20px;height:20px}
  .subheading{margin:6px 0 18px;color:var(--muted)}
  .notice{padding:14px 16px;border:1px solid #e5e7eb;border-radius:12px;background:#fff7ed}
</style>
</head>
<body>
  <div class="wrap">
    <h1 id="modelTitle">Modelo</h1>
    <p id="sectionTitle" class="subheading"></p>

    <div class="grid">
      <!-- Izquierda: IMAGEN -->
      <figure class="figure">
        <img id="hero" src="" alt="Imagen principal">
      </figure>

      <!-- Derecha: lista de características -->
      <section class="textCol">
        <div id="featureList" class="features" aria-label="Características"></div>
      </section>
    </div>

    <!-- Flechas -->
    <div class="controls-global">
      <button class="btn" id="prev" aria-label="Anterior">
        <svg viewBox="0 0 24 24" fill="none"><path d="M15 19l-7-7 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </button>
      <button class="btn" id="next" aria-label="Siguiente">
        <svg viewBox="0 0 24 24" fill="none"><path d="M9 5l7 7-7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </button>
    </div>

    <div id="msg" class="notice" style="display:none;margin-top:16px;"></div>
  </div>

<script>
(function(){
  const qs = new URLSearchParams(location.search);
  const modelKey = (qs.get('model') || 'MG_RX9').trim();

  const hero = document.getElementById('hero');
  const list = document.getElementById('featureList');
  const modelTitle = document.getElementById('modelTitle');
  const sectionTitle = document.getElementById('sectionTitle');
  const pageTitle = document.getElementById('pageTitle');
  const msg = document.getElementById('msg');

  let slides = [];
  let idx = 0;
  let imageBase = '';

  function showMessage(text){
    msg.textContent = text;
    msg.style.display = 'block';
  }

  function renderSlides(slidesData){
    slides = slidesData;
    list.innerHTML = slides.map((s, i) => `
      <article class="feat" data-idx="${i}">
        <h3 class="feat-title">${s.title}</h3>
        <p class="feat-desc">${s.desc}</p>
      </article>
    `).join('');
    [...document.querySelectorAll('.feat')].forEach(el => {
      el.addEventListener('click', () => setActive(+el.dataset.idx));
    });
  }

  function setActive(newIdx){
    idx = (newIdx + slides.length) % slides.length;
    const s = slides[idx];
    hero.src = imageBase + s.img;
    hero.alt = s.title;
    hero.classList.remove('fade'); void hero.offsetWidth; hero.classList.add('fade');
    [...document.querySelectorAll('.feat')].forEach((el, k) => el.classList.toggle('active', k === idx));
    const activeItem = document.querySelector(`.feat[data-idx="${idx}"]`);
    if(activeItem) activeItem.scrollIntoView({block:'nearest', behavior:'smooth'});
  }

  document.getElementById('next').addEventListener('click', () => slides.length && setActive(idx+1));
  document.getElementById('prev').addEventListener('click', () => slides.length && setActive(idx-1));
  window.addEventListener('keydown', e => {
    if(e.key === 'ArrowRight') slides.length && setActive(idx+1);
    if(e.key === 'ArrowLeft')  slides.length && setActive(idx-1);
  });

  // Carga dinámica del JSON
  fetch('AllModels.json', {cache:'no-cache'})
    .then(r => {
      if(!r.ok) throw new Error('No se pudo cargar AllModels.json');
      return r.json();
    })
    .then(data => {
      const model = data.models && data.models[modelKey];
      if(!model){
        showMessage(`No se encontró el modelo "${modelKey}" en AllModels.json.`);
        return;
      }

      imageBase = model.imageBase || '';
      const section = model.sections && model.sections.exterior;
      if(!section || !Array.isArray(section.slides) || !section.slides.length){
        showMessage(`El modelo "${modelKey}" no tiene una sección "exterior" con slides.`);
        return;
      }

      pageTitle.textContent = `${model.displayName} – Galería`;
      modelTitle.textContent = model.displayName;
      sectionTitle.textContent = section.title || 'Diseño exterior';

      renderSlides(section.slides);
      // Hero inicial (si existe hero, úsalo; si no, usa el slide 0)
      const initialImg = section.hero || section.slides[0].img;
      hero.src = imageBase + initialImg;
      hero.alt = section.slides[0].title || model.displayName;
      setActive(0);
    })
    .catch(err => {
      console.error(err);
      showMessage('Error al cargar la configuración de modelos. Revisa que AllModels.json esté disponible en el mismo origen.');
    });
})();
</script>
</body>
</html>
