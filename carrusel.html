<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title id="pageTitle">Galería – Modelos</title>
  <style>
    :root{
      --radius:14px; --shadow:0 8px 24px rgba(0,0,0,.08);
      --ink:#111; --muted:#4b5563; --line:#1f2937; --card:#fff;
      --padX:20px; --padY:28px;
    }
    *{box-sizing:border-box}
    html, body{height:100%;}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;padding:var(--padY) var(--padX) 48px;color:var(--ink);background:#fff;overflow:hidden}
    body.embed{ --padX:10px; --padY:10px; }
    h1{font-size:clamp(22px,3vw,44px);margin:0 0 6px;font-weight:650}
    .subheading{margin:0 0 14px;color:var(--muted);font-size:clamp(12px,1.8vw,16px)}

    /* Contenedor lógico diseñado a 1180px de ancho base */
    .stage{width:1180px;}
    .wrap{max-width:1180px;margin:0 auto}

    .grid{display:grid;grid-template-columns:1.4fr 1fr;gap:22px;align-items:stretch}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}

    .figure{background:#f5f5f7;border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow);display:flex;align-items:center;justify-content:center;min-height:320px}
    .figure img{width:100%;height:100%;object-fit:cover;display:block}
    .fade{animation:fade .35s ease-out}
    @keyframes fade{from{opacity:.2} to{opacity:1}}

    .textCol{border-radius:12px}
    .features{display:flex;flex-direction:column;gap:12px}
    .feat{background:var(--card);border:1px solid #e5e7eb;border-radius:12px;padding:12px 14px;box-shadow:0 1px 2px rgba(0,0,0,.03);position:relative;cursor:pointer}
    .feat-title{margin:0;font-size:clamp(14px,2.2vw,18px);font-weight:650;line-height:1.35}
    .feat-desc{margin:8px 2px 2px;color:var(--muted);line-height:1.55;font-size:clamp(12px,2vw,15px);display:none}
    .feat.active{border-color:#d1d5db}
    .feat.active::before{content:"";position:absolute;left:-1px;top:-1px;bottom:-1px;width:4px;border-radius:12px 0 0 12px;background:var(--line)}
    .feat.active .feat-desc{display:block}

    .controls-global{display:flex;justify-content:center;align-items:center;gap:14px;margin-top:14px}
    .btn{width:38px;height:38px;border-radius:50%;border:1px solid #d1d5db;background:#fff;display:grid;place-items:center;cursor:pointer;box-shadow:var(--shadow);transition:transform .08s}
    .btn:active{transform:scale(.96)}
    .btn svg{width:18px;height:18px}

    .notice{padding:12px 14px;border:1px solid #e5e7eb;border-radius:12px;background:#fff7ed;margin-top:12px;display:none}

    /* Autoscale: wrapper que se escala para caber en el iframe */
    #autoscaleWrap{ transform-origin: top left; width:1180px; }
  </style>
</head>
<body>
  <!-- autoscaleWrap permite escalar todo el contenido cuando el iframe es pequeño -->
  <div id="autoscaleWrap" class="stage">
    <div class="wrap">
      <h1 id="modelTitle"></h1>
      <p id="sectionTitle" class="subheading">&nbsp;</p>

      <div class="grid">
        <figure class="figure">
          <img id="hero" src="" alt="" />
        </figure>
        <section class="textCol">
          <div id="featureList" class="features" aria-label="Características"></div>
        </section>
      </div>

      <div class="controls-global">
        <button class="btn" id="prev" aria-label="Anterior">
          <svg viewBox="0 0 24 24" fill="none"><path d="M15 19l-7-7 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
        <button class="btn" id="next" aria-label="Siguiente">
          <svg viewBox="0 0 24 24" fill="none"><path d="M9 5l7 7-7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
      </div>

      <div id="msg" class="notice"></div>
    </div>
  </div>

<script>
(async function() {
  const params = new URLSearchParams(location.search);
  const modelKey = params.get("model") || "MG_RX9";

  try {
    const resp = await fetch("AllModels.json");
    const data = await resp.json();
    const model = data.models[modelKey];

    if (!model) {
      document.querySelector(".wrap").innerHTML = `<p>No se encontró el modelo: ${modelKey}</p>`;
      return;
    }

    const section = model.sections.exterior;
    const imageBase = model.imageBase;

    // Insertar título
    document.querySelector("h1").textContent = section.title;

    // Crear slides
    const slides = section.slides;
    const list = document.getElementById("featureList");
    list.innerHTML = slides.map((s, idx) => `
      <article class="feat" data-idx="${idx}">
        <h3 class="feat-title">${s.title}</h3>
        <p class="feat-desc">${s.desc}</p>
      </article>
    `).join('');

    const hero = document.getElementById("hero");
    const items = [...document.querySelectorAll(".feat")];
    let i = 0;

    function setActive(idx){
      i = (idx + slides.length) % slides.length;
      hero.src = imageBase + slides[i].img;
      hero.alt = slides[i].title;
      hero.classList.remove("fade"); void hero.offsetWidth; hero.classList.add("fade");
      items.forEach((el, k) => el.classList.toggle("active", k === i));
      items[i].scrollIntoView({block:"nearest", behavior:"smooth"});
    }

    // Eventos
    items.forEach(el => el.addEventListener("click", () => setActive(+el.dataset.idx)));
    document.getElementById("next").addEventListener("click", () => setActive(i+1));
    document.getElementById("prev").addEventListener("click", () => setActive(i-1));
    window.addEventListener("keydown", e => {
      if(e.key === "ArrowRight") setActive(i+1);
      if(e.key === "ArrowLeft") setActive(i-1);
    });

    // Estado inicial
    hero.src = imageBase + (section.hero || slides[0].img);
    setActive(0);

  } catch (err) {
    console.error(err);
    document.querySelector(".wrap").innerHTML = `<p>Error cargando AllModels.json</p>`;
  }
})();
</script>
</body>
</html>
