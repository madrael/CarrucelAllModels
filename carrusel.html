<!DOCTYPE html>
<!-- 
  /* 17-09-2025 V1.0000 (propuesta) */
  Archivo: carrusel_LastVersion.html
  Descripción: Carrusel dinámico (Imagen + Texto) desde AllModels.json.
  Cambios: Layout adaptable para iframe: imagen izquierda + texto derecha (en ancho suficiente), stacking en chico. fit=auto soportado.
-->
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title id="pageTitle">Carrusel – Modelos</title>
  <style>
    :root{
      --ink:#111; --muted:#4b5563; --card:#fff;
      --padX:20px; --padY:20px;         /* compacta con &embed=1 */
      --stageW:1180px;
      --gap:18px;                       /* separación entre columnas */
      --radius:16px; --shadow:0 10px 24px rgba(0,0,0,.06);
      --railBorder:#e5e7eb;
      --accent:#059669;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      margin:0; padding:var(--padY) var(--padX); color:var(--ink); background:#fff; overflow:hidden;
    }
    body.embed{ --padX:10px; --padY:10px; }

    /* wrapper escalable para iframes */
    #autoscaleWrap{ transform-origin: top left; width:var(--stageW); }
    .wrap{ max-width:var(--stageW); margin:0 auto }

    .card{
      background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow);
      padding:16px;
    }

    /* ====== LAYOUT 2 columnas responsive ====== */
    .row{
      display:grid; gap:var(--gap);
      grid-template-columns: 1fr;           /* apilado por defecto */
      align-items:stretch;
    }
    @media (min-width: 900px){
      .row{ grid-template-columns: 58% 42%; } /* imagen izquierda / texto derecha */
    }

    /* contenedor de imagen */
    .figure{
      background:#fff; border:1px solid var(--railBorder);
      border-radius:12px; overflow:hidden; min-height:360px;
      display:flex; align-items:center; justify-content:center; position:relative;
    }
    .figure img{
      width:100%; height:100%; object-fit:cover; display:block; /* cover para que llene la caja visual */
    }

    /* columna de texto */
    .copy{
      border:1px solid var(--railBorder); border-radius:12px;
      padding:18px 16px; background:#fff;
      display:flex; flex-direction:column; justify-content:center;
    }
    .kicker{ color:#6b7280; font-size:12px; letter-spacing:.05em; text-transform:uppercase; margin:0 0 6px }
    .title{ font-size:22px; line-height:1.25; margin:0 0 8px; }
    .desc{ color:#374151; line-height:1.55; margin:0 }

    /* navegación simple */
    .nav{
      display:flex; align-items:center; justify-content:center; gap:8px; margin-top:12px;
    }
    .btn{
      appearance:none; border:1px solid var(--railBorder); background:#fff;
      border-radius:999px; width:36px; height:36px; cursor:pointer;
      display:grid; place-items:center; box-shadow:0 2px 8px rgba(0,0,0,.06);
    }
    .btn:active{ transform:scale(.97) }

    .dots{ display:flex; gap:6px; padding:6px 10px; border-radius:999px; border:1px solid var(--railBorder); background:#fff; }
    .dot{ width:8px; height:8px; border-radius:999px; background:#d1d5db }
    .dot[aria-current="true"]{ background:var(--accent) }

    .notice{padding:10px 12px;border:1px solid var(--railBorder);border-radius:10px;background:#fff7ed;margin-top:12px;display:none}
  </style>
</head>
<body>
  <div id="autoscaleWrap">
    <div class="wrap">
      <div class="card">
        <div id="row" class="row">
          <figure class="figure">
            <img id="hero" src="" alt="" />
          </figure>
          <div class="copy">
            <p id="kicker" class="kicker"></p>
            <h2 id="title" class="title"></h2>
            <p id="desc" class="desc"></p>
          </div>
        </div>

        <div class="nav">
          <button id="prev" class="btn" title="Anterior">‹</button>
          <div id="dots" class="dots" aria-label="Paginación"></div>
          <button id="next" class="btn" title="Siguiente">›</button>
        </div>
      </div>

      <div id="msg" class="notice"></div>
    </div>
  </div>

  <script>
  (function(){
    const qs = new URLSearchParams(location.search);
    const modelKey = qs.get('model');                 // ?model=MG_RX9
    const interior = (qs.get('Interior') || 'NO').toUpperCase() === 'SI'; // SI => interior
    const fit = (qs.get('fit') || '').toLowerCase();  // 'auto' => escalar wrapper para iframe
    const embed = qs.get('embed') === '1';            // '1' => paddings compactos
    const minScale = Math.max(0.2, Math.min(1, parseFloat(qs.get('min') || '0.5')));

    if(embed) document.body.classList.add('embed');

    const hero = document.getElementById('hero');
    const kickerEl = document.getElementById('kicker');
    const titleEl = document.getElementById('title');
    const descEl = document.getElementById('desc');
    const dots = document.getElementById('dots');
    const msg = document.getElementById('msg');
    const autoscaleWrap = document.getElementById('autoscaleWrap');

    let imageBase = '';
    let slides = [];
    let idx = 0;

    function showMessage(t){ msg.textContent=t; msg.style.display='block'; }
    function clearMessage(){ msg.textContent=''; msg.style.display='none'; }

    // URL robusta para GH Pages (raíz o subcarpeta del repo)
    function jsonURL(){
      const segs = location.pathname.split('/').filter(Boolean);
      const repo = segs.length ? segs[0] : '';
      if(location.host.endsWith('github.io') && repo) return `/${repo}/AllModels.json`;
      return '/AllModels.json';
    }

    function renderDots(){
      if(!slides.length){ dots.innerHTML=''; return; }
      dots.innerHTML = slides.map((_,i)=>`<span class="dot" data-i="${i}" aria-current="${i===idx}"></span>`).join('');
      [...dots.children].forEach(el => el.addEventListener('click', ()=> go(+el.dataset.i)));
    }

    function paint(){
      const s = slides[idx]; if(!s) return;
      hero.src = imageBase + (s.img || s.image || '');
      hero.alt = (s.alt || s.title || s.caption || 'imagen');
      kickerEl.textContent = interior ? 'Interior' : 'Exterior';
      titleEl.textContent = s.title || '';
      descEl.textContent = s.desc || s.caption || '';
      renderDots();
      autoScale();
    }

    function go(n){
      if(!slides.length) return;
      idx = (n + slides.length) % slides.length;
      paint();
    }

    document.getElementById('prev').addEventListener('click', ()=> go(idx-1));
    document.getElementById('next').addEventListener('click', ()=> go(idx+1));
    window.addEventListener('keydown', (e)=>{
      if(e.key==='ArrowRight') go(idx+1);
      if(e.key==='ArrowLeft')  go(idx-1);
    });

    /* === AutoScale para iframe === */
    function autoScale(){
      if(fit !== 'auto') return;
      const baseW = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--stageW')) || 1180;
      const baseH = document.querySelector('.wrap').scrollHeight;
      const padX = parseInt(getComputedStyle(document.body).getPropertyValue('--padX')) || 0;
      const padY = parseInt(getComputedStyle(document.body).getPropertyValue('--padY')) || 0;
      const vw = Math.max(0, window.innerWidth  - padX*2);
      const vh = Math.max(0, window.innerHeight - padY*2);
      const s = Math.max(minScale, Math.min(vw / baseW, vh / baseH || 1));
      autoscaleWrap.style.transform = `scale(${s})`;
      autoscaleWrap.style.height = `${baseH}px`;
      document.body.style.overflow = 'hidden';
    }
    window.addEventListener('resize', autoScale);

    /* === Carga de datos === */
    if(!modelKey){ showMessage('Falta el parámetro ?model='); autoScale(); return; }

    fetch(jsonURL(), {cache:'no-cache'})
      .then(r=>{ if(!r.ok) throw new Error('No se pudo cargar AllModels.json'); return r.json(); })
      .then(data=>{
        const model = data && data.models && data.models[modelKey];
        if(!model){ showMessage(`No se encontró el modelo "${modelKey}"`); autoScale(); return; }
        clearMessage();

        imageBase = model.imageBase || '';

        // obtenemos sección exterior/interior según estructura:
        // preferimos model.sections.exterior/interior.items
        let section = null;
        if(model.sections){
          section = interior ? model.sections.interior : model.sections.exterior;
        }
        // si el modelo usa otra convención, intenta con model.exterior/items o model.interior/items
        if(!section){ section = interior ? model.interior : model.exterior; }

        const items = section && Array.isArray(section.items) ? section.items : [];
        if(!items.length){ showMessage('No hay elementos en la sección seleccionada.'); autoScale(); return; }

        slides = items.map(it => ({
          img: it.img || it.image || '',
          title: it.title || it.titulo || '',
          desc: it.desc || it.caption || it.text || ''
        }));

        document.getElementById('pageTitle').textContent =
          `${model.displayName || modelKey} – ${interior?'Interior':'Exterior'}`;

        idx = 0;
        paint();
        requestAnimationFrame(autoScale);
        setTimeout(autoScale, 120);
      })
      .catch(err=>{
        console.error(err);
        showMessage('Error al cargar la configuración. Verifica AllModels.json en la raíz del repo.');
        autoScale();
      });
  })();
  </script>
</body>
</html>

