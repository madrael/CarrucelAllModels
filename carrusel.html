<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title id="pageTitle">Galería – Modelos</title>
  <style>
    :root{
      --radius:14px; --shadow:0 8px 24px rgba(0,0,0,.08);
      --ink:#111; --muted:#4b5563; --line:#1f2937; --card:#fff;
      --padX:20px; --padY:28px;
    }
    *{box-sizing:border-box}
    html, body{height:100%}
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      margin:0; padding:var(--padY) var(--padX) 48px;
      color:var(--ink); background:#fff; overflow:hidden;
    }
    body.embed{ --padX:10px; --padY:10px; }

    h1{font-size:clamp(22px,3vw,44px);margin:0 0 6px;font-weight:650}
    .subheading{margin:0 0 14px;color:var(--muted);font-size:clamp(12px,1.8vw,16px)}

    .stage{width:1180px}
    .wrap{max-width:1180px;margin:0 auto}

    /* Grid principal */
    .grid{display:grid;grid-template-columns:1.4fr 1fr;gap:22px;align-items:stretch}
    @media (max-width:900px){
      .grid{grid-template-columns:1fr}
      .figure{max-height:280px}   /* limitamos alto en móviles */
    }

    .figure{
      background:#f5f5f7;border-radius:var(--radius);overflow:hidden;
      box-shadow:var(--shadow);display:flex;align-items:center;justify-content:center;
      min-height:320px; max-height:520px;
    }
    .figure img{
      width:100%;height:100%;object-fit:contain;
      display:block;transition:transform .2s ease;
    }
    .fade{animation:fade .35s ease-out}
    @keyframes fade{from{opacity:.2} to{opacity:1}}

    .textCol{border-radius:12px}
    .features{display:flex;flex-direction:column;gap:12px}
    .feat{background:var(--card);border:1px solid #e5e7eb;border-radius:12px;padding:12px 14px;box-shadow:0 1px 2px rgba(0,0,0,.03);cursor:pointer}
    .feat-title{margin:0;font-size:clamp(14px,2.2vw,18px);font-weight:650}
    .feat-desc{margin:8px 2px 2px;color:var(--muted);line-height:1.55;font-size:clamp(12px,2vw,15px);display:none}
    .feat.active{border-color:#d1d5db}
    .feat.active::before{content:"";position:absolute;left:-1px;top:-1px;bottom:-1px;width:4px;border-radius:12px 0 0 12px;background:var(--line)}
    .feat.active .feat-desc{display:block}

    .controls-global{display:flex;justify-content:center;align-items:center;gap:14px;margin-top:14px}
    .btn{width:38px;height:38px;border-radius:50%;border:1px solid #d1d5db;background:#fff;display:grid;place-items:center;cursor:pointer;box-shadow:var(--shadow)}
    .btn svg{width:18px;height:18px}

    .notice{padding:12px 14px;border:1px solid #e5e7eb;border-radius:12px;background:#fff7ed;margin-top:12px;display:none}
    #autoscaleWrap{ transform-origin: top left; width:1180px; }
  </style>
</head>
<body>
  <div id="autoscaleWrap" class="stage">
    <div class="wrap">
      <h1 id="modelTitle"></h1>
      <p id="sectionTitle" class="subheading">&nbsp;</p>

      <div class="grid">
        <figure class="figure">
          <img id="hero" src="" alt="" />
        </figure>
        <section class="textCol">
          <div id="featureList" class="features"></div>
        </section>
      </div>

      <div class="controls-global">
        <button class="btn" id="prev">◀</button>
        <button class="btn" id="next">▶</button>
      </div>

      <div id="msg" class="notice"></div>
    </div>
  </div>

  <script>
  (function(){
    const qs = new URLSearchParams(location.search);
    const modelKey = qs.get('model');
    const isInterior = (qs.get('Interior') || 'NO').toUpperCase() === 'SI';
    const sectionKey = isInterior ? 'interior' : 'exterior';
    const fit = (qs.get('fit') || '').toLowerCase();
    const embed = qs.get('embed') === '1';
    if(embed) document.body.classList.add('embed');

    const hero = document.getElementById('hero');
    const list = document.getElementById('featureList');
    const modelTitle = document.getElementById('modelTitle');
    const sectionTitle = document.getElementById('sectionTitle');
    const pageTitle = document.getElementById('pageTitle');
    const msg = document.getElementById('msg');
    const autoscaleWrap = document.getElementById('autoscaleWrap');

    let slides = [], idx=0, imageBase='';

    function showMessage(t){ msg.textContent=t; msg.style.display='block'; }
    function clearMessage(){ msg.textContent=''; msg.style.display='none'; }

    function renderSlides(slidesData){
      slides = slidesData;
      list.innerHTML = slides.map((s,i)=>`
        <article class="feat" data-idx="${i}">
          <h3 class="feat-title">${s.title}</h3>
          <p class="feat-desc">${s.desc}</p>
        </article>`).join('');
      [...document.querySelectorAll('.feat')].forEach(el=> el.addEventListener('click',()=>setActive(+el.dataset.idx)));
    }

    function setActive(newIdx){
      if(!slides.length) return;
      idx=(newIdx+slides.length)%slides.length;
      const s=slides[idx];
      hero.src=imageBase+s.img;
      hero.alt=s.title||'';
      hero.classList.remove('fade'); void hero.offsetWidth; hero.classList.add('fade');
      [...document.querySelectorAll('.feat')].forEach((el,k)=> el.classList.toggle('active',k===idx));
    }

    document.getElementById('next').addEventListener('click',()=>setActive(idx+1));
    document.getElementById('prev').addEventListener('click',()=>setActive(idx-1));

    function autoScale(){
      if(fit!=='auto') return;
      const baseW=1180, baseH=autoscaleWrap.scrollHeight;
      const vw=window.innerWidth-40, vh=window.innerHeight-40;
      const s=Math.max(0.5,Math.min(vw/baseW,vh/baseH));
      autoscaleWrap.style.transform=`scale(${s})`;
      autoscaleWrap.style.height=`${baseH}px`;
      document.body.style.overflow='hidden';
    }
    window.addEventListener('resize',autoScale);

    if(!modelKey){ showMessage('No se especificó modelo'); autoScale(); return; }

    fetch('AllModels.json',{cache:'no-cache'})
      .then(r=>r.json())
      .then(data=>{
        const model=data.models[modelKey];
        if(!model){ showMessage(`Modelo no encontrado: ${modelKey}`); autoScale(); return; }
        clearMessage();
        imageBase=model.imageBase||'';
        const section=model.sections[sectionKey];
        if(!section){ showMessage(`Sección no encontrada: ${sectionKey}`); autoScale(); return; }
        pageTitle.textContent=`${model.displayName||modelKey} – Galería`;
        modelTitle.textContent=model.displayName||modelKey;
        sectionTitle.textContent=section.title||'';
        renderSlides(section.slides);
        hero.src=imageBase+(section.hero||section.slides[0].img);
        setActive(0);
        requestAnimationFrame(autoScale);
        setTimeout(autoScale,100);
      })
      .catch(err=>{console.error(err); showMessage('Error al cargar JSON'); autoScale();});
  })();
  </script>
</body>
</html>
